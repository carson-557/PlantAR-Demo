<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>PlantAR — 植物识别 AR 展示</title>
    <link rel="stylesheet" href="./styles.css" />

    <!-- A-Frame + AR.js (Marker 版本，比 NFT 更稳定) -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <!-- A-Frame Extras - 支持 GLTF 动画 -->
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body style="margin: 0px; overflow: hidden">

    <!-- Loading -->
    <div class="arjs-loader">
        <div class="spinner"></div>
        <p class="loading-text">正在初始化 AR...</p>
    </div>

    <!-- Watermark -->
    <div class="watermark">
        <i class="fa-solid fa-leaf"></i>
        PlantAR
    </div>

    <!-- Control Icons -->
    <div class="icon-btn info-icon">
        <i class="fa-solid fa-info"></i>
    </div>
    <div class="icon-btn scale-icon">
        <i class="fa-solid fa-expand"></i>
    </div>

    <!-- 扫描提示 -->
    <div id="scanHint"
        style="position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); color: white; text-align: center; z-index: 100; pointer-events: none;">
        <div style="background: rgba(0,0,0,0.6); padding: 15px 25px; border-radius: 20px; backdrop-filter: blur(5px);">
            <i class="fa-solid fa-leaf" style="font-size: 24px; margin-bottom: 8px; color: #4ade80;"></i>
            <p style="margin: 0; font-size: 14px;">请扫描植物标记</p>
        </div>
    </div>

    <!-- 浮动信息 UI (识别成功后显示) -->
    <div class="floating-info-container" id="floatingInfo" style="display: none;">
        <div class="float-card float-top" id="floatName">
            <div class="float-card-inner">
                <div class="plant-name-badge">
                    <i class="fa-solid fa-leaf"></i>
                    <span class="main-name" id="floatTitle">滴水观音</span>
                </div>
                <span class="sub-name" id="floatEnglish">Alocasia macrorrhizos</span>
            </div>
        </div>

        <div class="float-card float-left-top" id="floatFamily">
            <div class="float-card-inner">
                <div class="float-icon"><i class="fa-solid fa-seedling"></i></div>
                <div class="float-content">
                    <span class="float-label">科属</span>
                    <span class="float-value" id="floatFamilyValue">天南星科</span>
                </div>
            </div>
        </div>

        <div class="float-card float-right-top" id="floatOrigin">
            <div class="float-card-inner">
                <div class="float-icon"><i class="fa-solid fa-earth-asia"></i></div>
                <div class="float-content">
                    <span class="float-label">产地</span>
                    <span class="float-value" id="floatOriginValue">亚洲热带</span>
                </div>
            </div>
        </div>

        <div class="float-card float-left-bottom" id="floatCategory">
            <div class="float-card-inner">
                <div class="float-icon category-icon"><i class="fa-solid fa-tag"></i></div>
                <div class="float-content">
                    <span class="float-label">分类</span>
                    <span class="float-value" id="floatCategoryValue">多年生草本</span>
                </div>
            </div>
        </div>

        <div class="float-card float-right-bottom" id="floatFeature">
            <div class="float-card-inner">
                <div class="float-icon feature-icon"><i class="fa-solid fa-star"></i></div>
                <div class="float-content">
                    <span class="float-label">特性</span>
                    <span class="float-value" id="floatFeatureValue">叶大如伞</span>
                </div>
            </div>
        </div>

        <div class="float-card float-bottom fun-fact-card" id="floatFunFact">
            <div class="float-card-inner">
                <div class="fun-fact-header">
                    <i class="fa-solid fa-lightbulb"></i>
                    <span>你知道吗？</span>
                </div>
                <p class="fun-fact-text" id="floatFunFactText">
                    滴水观音在空气湿度高时，叶尖会凝结水珠滴落，这是植物的"吐水现象"！
                </p>
            </div>
        </div>
    </div>

    <!-- 详细信息面板 -->
    <div class="info-panel" id="infoPanel" style="display: none;">
        <div class="info-header">
            <div class="title-section">
                <h2 id="plantTitle">滴水观音</h2>
                <span class="plant-english" id="plantEnglish">Alocasia macrorrhizos</span>
            </div>
            <span class="plant-category" id="plantCategory">多年生草本</span>
        </div>
        <p id="plantDescription">滴水观音又称海芋、象耳芋，是天南星科海芋属植物。因其叶片巨大如象耳，且在湿度大时叶尖会滴水而得名。是常见的室内观叶植物，但全株有毒，需小心养护。</p>
        <div class="go-corner">
            <div class="go-close close-wrapper">
                <i class="fa-solid fa-xmark close-icon"></i>
            </div>
        </div>
    </div>

    <!-- A-Frame AR 场景 (Hiro Marker 版本) -->
    <a-scene embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true; precision: medium;">
        <!-- 自定义植物标记 (增加平滑参数减少晃动) -->
        <a-marker type="pattern" url="./pattern-plant_marker_crop_white.patt" id="plantMarker" smooth="true"
            smoothCount="30" smoothTolerance="0.005" smoothThreshold="8">
            <!-- 3D 植物模型 (播放一次生长动画，停在完整状态) -->
            <a-entity id="plantModel" gltf-model="./models/elephant_ear/scene.gltf" scale="0.3 0.3 0.3"
                position="0 0.5 0" rotation="-90 0 0"
                animation-mixer="loop: once; clampWhenFinished: true; timeScale: 1"></a-entity>
        </a-marker>

        <!-- 摄像头实体 -->
        <a-entity camera></a-entity>
    </a-scene>

    <script src="./script-marker.js"></script>
</body>

</html>